# 예외 처리

- Controller 레벨에서 처리
- Global 레벨에서 처리
- HandlerExceptionResolver를 이용한 처리

## Controller 레벨에서 처리
- Spring은 Controller에서 발생한 예외를 공통적으로 처리할 수 있는 기능을 제공한다. 
- @ExceptionHandler 어노테이션을 통해 Controller의 메소드에서 throw된 Exception에 대한 공통적인 처리를 지원합니다.
- Controller 메소드 내의 하위 서비스에서 Checked Exception이 발생하더라도, Controller 메소드 상위까지 throw 시키면 @ExceptionHandler 어노테이션을 사용하여 Controller 전역적으로 예외처리가 가능하다.
- Controller 메소드 내의 하위 서비스에서 Runtime Exception이 발생하면, 서비스를 호출한 차상위 Controller에서 해당 예외를 처리해준다.
- Service layer에서 발생한 예외를 상위 메서드로 던져서 Controller에서 한 번에 처리할 수 있다.

```java

@Controller
public class DemoController {
    
    @GetMapping(path="/exception/demo")
    public String occurDemoException() {
        throw new DemoException(); // RuntimeException
    }
    
    @GetMapping(paht="/exception/demo2")
    public String occurDemoException2() {
        throw new DemoException(); // RuntimeException
    }
    
    @ExceptionHandler(value=DemoException.class)
    public String handleDemoException(DemoException e) {
        log.error(e.getMessage());
        return "/error/404";
    }
}
```

## checked와 Transactional, rollback

- Java에서 Exception은 Checked(필수)와 Unchecked(필수 X)로 나뉜다.
- Spring에서는 Runtime Exception(Unchecked)이 발생하면 rollback 하지만 Checked Exception이 발생하면 Rollback하지 않는다.
- 하지만 Transactional의 rollbackFor를 사용하면 rollback할 수 있다.

```java
@Transactional(rollbackFor = {CheckedException.class, CheckedException2.class})
public void savBook(BookRequest bookRequest) {
    bookRepository.save(new ....);
}
```
