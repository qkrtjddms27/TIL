# Authentication&Authorization
인증과 인가는 본인이 누군인지 로그인, 핀 번호 등을 통해 인증(Authentication)을 받고 해당 요청(request)에 대한 권한(Authorization)이 있는지 확인하는 것.
인증과 인가를 통해 특정 인물에 대한 정보를 확인하고, 특정 요청에 대한 권한을 확인합니다.

## JWT, Json Web Token
- 토큰 기반 인증 방식
- 세션에 사용자 정보를 서버에 저장할 필요기 때문에 세션서버가 필요하지 않다. (stateless)
- 헤더와 내용, 서명으로 나뉜다.

### JWT 헤더, 내용(payload), 서명
- 헤더는 토큰의 타입과 해시알고리즘 정보가 들어간다.
- 내용(payload)은 exp와 같은 만료시간을 나타내는 공개 클레임(토큰에서 사용하는 각 정보 조각).
    + {'userId' : 23, iat : 12541238}
- 토큰에 로그인한 사용자의 정보가 담겨있따면 Self-contained 토큰이라고 부른다.
    + 토큰 자체로부터 사용자의 상태 정보를 얻을 수 있으면, 데이터베이스에 쿼리를 최소화 하는 이점을 얻을 수 있다.
- 헤더와 페이로드를 Base64로 인코딩하고, 서버의 비밀 키와 함께 암호화 알고리즘에 넣어서 돌리면 서명을 얻을 수 있다.

## 토큰을 통한 Authorization 과정, 토큰 인가 과정
- 서버가 클라이언트로부터 토큰을 받는다.
- 해당 토큰의 헤더, 페이로드와 자신의 비밀 키를 이요하여 서명을 계산한다.
- 해당 토큰의 서명이 방금 계산한 값과 동일한지 검사한다.
- 만약 동일하지 않다면 요청을 거부하고, 동일하다면 해당 토큰의 유효 기한을 확인한다.
- 해당 토큰의 유효 기한이 아직 지나지 않았다면, 요청이 허가된다.

## JWT의 한계
- 서버와 클라이언트중 비교적 보안이 취약한 클라이언트 단에 저장된다.
- 이미 발급된 JWT토큰은 무효화 하기 어렵다.
    + JWT는 무상태로 관리되고 위와 같은 과정을 거치면서 임의로 중간에 폐기하기가 어렵다.
    + 유효기간이 끝날때까지 해당 토큰을 계속 사용할 수 있다.
    
## 리프레시 토큰을 통한 한계 극복
- 리프레시 토큰을 사용하기 위해서는 인증과정을 이후에 액세스 토큰과 리프레시 토큰 2가지 발행한다.
- 액세스 토큰은 위에서 말한 인가의 과정에서 사용되는 토큰이다.
- 리프레시 토큰은 액세스 토큰을 다시 발급받기 위해 서버에서 전송하는 토큰이다.
    + 액세스 토큰의 유효기간이 끝나면 서버에서는 로그인을 요구하지만 리프레시 토큰을 사용하면 로그인 과정없이 바로 발급이 가능하다
    + 리프레시 토큰은 유효기간이 액세스 토큰보다 길다.
    + 리프레시 토큰은 서버에서 관리한다.
- 리프레시 토큰을 사용하여 액세스 토큰의 시간을 사용자의 불편함없이 짧게 설정 가능하다.
- 리프레시 토큰은 탈취당하면 서버에서 관리할 수 있으므로 폐기할 수 있다.