# Filter, Interceptor, AOP

## 공통점
관련된 공통 코드를 모든 메서드, 모든 페이지마다 각자 추가해서 관리한다면 유지보수가 어려워진다. 핵심 로직을 제외하고 공통적인 부분을 추가해서 사용하는 것이 좋다.

## Filter, Interceptor, AOP 동작 순서
Filter -> Interceptor -> AOP -> Interceptor -> Filter

## Dispatcher-Servlet, 디스패처 서블릿
- HTTP 프로토콜로 들어오는 모든 요청을 가장 먼저 받아 적합한 컨트롤러에 위임해주는 프론트 컨트롤러.
- 디스패처 서블릿에서 공통적으로 처리해야하는 작업을 먼저 처리후 해당 컨트롤러에게 위임 해준다.

### 디스패처 서블릿 동작 과정
- 클라이언트의 요청을 디스패처 서블릿이 받음
    + 클라이언트의 요청은 가장 먼저 디스패처 서블릿이 받아서 공통 부분을 처리함
- 요청 정보를 통해 요청을 위임할 컨트롤러를 찾음
    + 모든 컨트롤러 빈을 파싱하여 HashMap으로 관리.
    + Http Method, URI 등을 사용해 Key 객체인 요청 정보를 만들고, Value인 요청을 처리할 HandlerMethod를 찾아 반환
- 요청을 컨트롤러로 위임할 핸들러 어댑터를 찾아서 전달함
    + 어댑터를 사용하는 이유는 공통적인 전/후처리 과정이 필요하기 때문.
- 핸들러 어댑터가 컨트롤러로 요청을 위임함.
- 비즈니스 로직을 처리함.
- 컨트롤러가 값을 반환.
- HandlerAdapter가 반환값을 처리함.
- 서버의 응담을 클라이언트로 반환.

## Filter
- 요청과 응답을 거른뒤 정제하는 역할.
- DispatcherServlet 이전에 실행이 되는데 필터가 동작하도록 지정된 자원의 앞단에서 요청내용을 변경하거나 체크한다.
- 인코딩변환, XSS방어 등.
- init() - 필터 인스턴스 초기화, doFilter() - 전/후 처리, destory() - 필터 인스턴스 종료.

## Interceptor
- 요청에 대한 작업 전/후로 동작.
- 필터는 스프링 컨텍스트 외부에서 동작하지만 인터셉터는 스프링의 DispatcherServlet이 컨틀롤러를 호출하기 전, 후로 동작
- 스프링의 모든 빈 객체에 접근 할 수 있다.
- preHandler() - 컨트롤러 메서드가 실행되기 전, postHandler() - 컨트롤러 메서드 실행직후, afterCompletion() - View페이자가 렌더링 되고 난 후

## AOP
- Interceptor나 Filter와는 달리 메소드 전후의 지점에 자유롭게 설정 가능
- AOP는 주소, 파라미터, 애노테이션 등 다양한 방법으로 대상을 지정할 수 있다.

### 용어 정리
- Aspect : 흩어진 관심사를 모듈화(메스드화) 한 것. 주로 부가기능을 모듈화함
  + 로깅
- Target : Aspect를 적용하는 곳 (클래스, 메서드)
- Advice : 실질적으로 어떤 일을 해야할 지에 대한 것, 실질적인 부가기능을 담은 구현체
- JointPoint : Advice가 적용될 위치, 메스드 진입 지점, 생성자 호출 시점, 필드에서 값을 꺼내올 때 등 다양한 시점에 적용가능
- PointCut : JointPoint의 상세한 스펙을 정의한 것. '표현식이 있음'