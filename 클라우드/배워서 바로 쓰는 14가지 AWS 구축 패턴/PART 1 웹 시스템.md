# 웹 시스템

## 최소 구성은 단일 서버, 실수하기 쉬운 설정 문제 주의사항

> 간단한 이벤트 사이트에 사용할 공개 웹 서버를 최소한의 요소로 구성하여 만드는 방법.

### 일시적으로 운용할 소규모 웹 서버 구성

```
- 1개월 한정으로 이용
- 사이트 사용자는 개인 사용자로서 인터넷으로 접속
- 업속자 수는 많지 않아 고사양 서버는 필요 없다.
- 웹 서버로 LAMP(Linux, Apache, PHP, MySQL) 환경을 사용
- 비용을 우선하며 다중화나 백업은 신경쓰지 않는다.
```

#### 인프라 핵심 설계사항
- 리전 선택 : 이벤트 사이트를 구동시킬 최적의 리전을 선택한다.
- EC2 인스턴스 설정 : 이벤트 사이트의 웹 서버를 적합한 EC2 인스턴스를 설정한다.
- 도메인을 통한 접속 : 고정 IP 주소와 접속한다(CNAME 설정을 통해 고정 IP 주소가 아닌 도메인 이름을 이용하여 도메인에 접속할 수도 있다.)
- 네트워크 구성 : 인터넷 접속을 위해 간단한 네트워크 구성을 설정한다.
- 웹 서버로서 OS 환경 설정 : 아마존 리눅스에 LAMP 환경을 설정한다.

#### 리전
- 지리적으로 가까울 수록 응답속도가 빨라짐
- 속도가 고려사항이 아니라면 리전마다 가격이 다르니 가격에 맞게 사용하는 것이 좋다.

#### VPC와 서브넷
- VPC는 Virtual Private Cloud의 약자
  + VPC는 논리적으로 격리된 사용자 전용 네트워크 구역
  + 복수의 가용 영역(AZ, Availability Zones)에 걸친 형태로 VPC 하나를 작성할 수 있습니다.
- 서브넷은 VPC를 논리적으로 분리한 서브네트워크로 AWS 환경 내의 네트워크 최소 단위.
  + 서브넷은 단일 AZ 안에 작성

#### EC2 인스턴스 작성
- 이벤트 사이트의 웹 서버 역할을 할 EC2인스턴스 생성
- EC2 인스턴스는 웹 설정 화면에서 미리 정의된 옵션을 선택하여 설정할 수 있다.
  + AMI(Amazon Machine Image)는 즉시 사용이 가능한 상태의 OS 및 패키지 조합.
  + AMI의 가상화 타입으로 완전가상화인 HVM과 PV가 있다.
    * AWS는 PV의 지원을 축소하면서 HVM으로 전환을 진행하고 있어, HVM이 성능이 더 탁월하다.
  + AMI의 인스턴스 유형을 선택할떄 CPU,메모리, 스토리지, 네트워크 성능 조합을 선택할 수 있다..
    * 하지만 특정 성능 즉 메모리만 늘린다든지 하는 세세한 사용자 정의는 할 수 없다.

#### 네트워크 및 셧다운 동작 설정 주의사항
> 인스턴스 유형을 정했다면 EC2 인스턴스를 설정할 차례.

- 퍼블릭 IP 주소를 자동 할당하는 퍼블릭 IP 자동 할당(Auto-assign Public IP)을 비활성화
  + 활성화하면 동적 퍼블릭 IP 주소가 부여되지만 인터넷에서 접속이 가능.
  + EC2 인스턴스가 다시 시작할 때마다 자동으로 변경되므로 재시작할 때마다 IP 주소 또는 DNS를 다시 지정해주어야 한다.

- EC2 인스턴스를 정지하는 경우의 동작 설정에도 주의가 필요.
  + 셧다운 동작에는 정지와 종료가 있다.
    * 정지는 셧다운 시에 OS가 정지되어 OS이미지가 보존되어 재시작하면 같은 상태로 시작.
    * 종료를 선택하면 OS를 정지하는 것과 동시에 EC2 인스턴스를 삭제.
  + EC2 인스턴스를 유지하는 시스템에서는 '종료 보호 활성화'를 체크하면 관리 화면에서 조작 실수로 인스턴스가 삭제되는 것을 막을 수 있다.

#### 보안 그룹 설정으로 통신 필터링하기
> EC2 인스터스 설정의 마지막 단계는 보안 그룹 설정입니다. 보안 그룹은 OS 레벨에서 네트워크 통신 필터링 룰을 정하는 것으로 허가할 프로토콜을 설정합니다.

- 보안 그룹 Source의 초기 설정값이 Anywhere로 되어 있는데, 이는 모든 IP 주소로부터의 SSH 접속을 허가한다는 의미.
  + Source값으로 My IP를 설정하면 현재 접속한 기기의 퍼블릭 IP 주소에서의 접속만을 받아들이게 됨.
  + 퍼블릭 IP 주소가 여럿인 경우 `Custom IP`를 선택하고 주소 범위를 CIDR 표기법으로 적는다.
- HTTP/HTTPS 접속을 허가할 필요가 있다.
  + 두 프로토콜에 대해서는 어떤 IP에서든 접속할 수 있게 [0.0.0.0/0]으로 설정한다.

#### 고정 IP와 호스트명으로 접속하게 하기
> 아직 인터넷으로 시작된 EC2 인스턴스에 접속할 수 없다. 인터넷으로 접속하려면 고정 퍼블릭 IP 주소와 FQDN(호스트명)을 부여해야 한다. 고정 퍼블릭 IP는
> EIP라고 부른다.

- EIP를 포함한 서비스 설정 변경과 추가는 매니지먼트 콘솔(AWS Management Console)에서 진행.
- EIP 설정은 매니지먼트 콘솔을 통해 EC2 서비스로 들어간 후 탐색창의 `Elastic IPs` 페이지에서 `Allocate New Address`를 선택.
- AWS에서는 라우트 53이라는 DNS 서비스를 제공.
  + 이것도 마찬가지로 매니지먼트 콘솔에서 설정 가능
  + 라우트 53의 네비게이션 메뉴에서 `Hosted zones`를 선택한 후 `Create Hosted Zone`을 선택하여 도메인 이름으로 인식시키기

#### VPC 설정으로 인터넷 접속 설정하기
> VPC는 AWS 데이터 센터 내부에 마련된 가상의 폐쇄 네트워크이며, 외부와 통신할 수 있도록 설정해야 합니다.

- VPC의 DNS 관련 설정.
  + `DNS resolution`은 VPC 내에서 DNS를 확인을 활성화 여부
  + `DNS hostname`은 DNS 이름을 부여할지 여부를 활성화
- 라우팅 설정
  + 라우트 테이블에 인터넷 게이트웨이가 설정되어 있지 않다면 인터넷 접속이 불가능
  + VPC 설정 화면 탐색창의 `Route Tables`에서 라우팅 테이블을 선택하고 하단 창의 `Routes`탭을 확인
  + `Destination`과 `Target`의 조합에 0.0.0.0/0과 'igw-'로 시작하는 인터넷 게이트웨이가 없으면 'Edit' 버튼을 눌러 등록.

#### OS 환경을 웹 서버로 설정하기
- SSH 클라이언트를 사용하여 웹 서버에 연결된 EIP에 접속.
- EC2 인스턴스에 SSH로 접속할 때는 공개키 인증 방식을 이용. EC2 인스턴스 작성의 마지막 단계는 다운로드한 비밀킬를 읽어 들여 접속.

#### 운영 중에 리소스를 유연하게 변경하기ㅏ
- 인스턴스 정지하고, 매니지먼트 콘솔에서 해당 인스턴스를 마우스 오른쪽 버튼으로 클릭한 후 콘텍스트 메뉴에서 `Instance Settings`, `Change Instance Tpye`을 선택
  + 다시 시작해야하는 불편함은 있지만 자원을 유연하게 변경할 수 있다.

- 디스크 추가는 EBS 용량 변경으로
  + 디스크는 가상 저장소인 EBS로서 EC2 인스턴스와는 독립적으로 만든다.


### 오늘날은 AWS는 관리형 서비스입니다.
> AWS를 Ec2로 대표되는 IaaS를 제공하는 클라우드 사업자로 인식하는 분이 많을 겁니다. 하지만 실제로는 OS와 미들웨어까지 관리하는 Paas와 소프트웨어까지 관리하는 Saas도 제공하며 그 숫자가 점점 늘고 있습니다.
> 이러한 서비스를 관리형 서비스라고 부릅니다. 주요 관리형 서비스로는 스토리지 서비스 아마존 S3, 데이터베이스 서비스 RDS, DNS 서비스 아마존 라우트 53, 서버리스 코드 실행 서비스 람다등이 있습니다.
> 관리형 서비스에서는 사용자가 OS에 접속할 수 없습니다. AWS가 인스턴스를 관리하기 때문입니다. 장점은 버전업이나 다중화, 백업 등의 작업을 사용자가 직접 할 필요가 없다는 것이고, 단점은 성능 문제가 발생해도 개선 방안이 많지 않다는 것 입니다. 사용자가 변경 가능한
> 범위가 적어지기 때문에 바꿀 수 있는 범위가 적기 때문입니다.